# CSV 数据导入使用指南

## ✅ 功能已修复完成！

现在你可以使用最简单、最直接的方式导入学生数据到 PocketBase。

## 🚀 使用方法

### 方法 1: 网页界面导入
1. 访问: http://localhost:3000/data-import
2. 选择以下任一方式：
   - **上传 CSV 文件**: 点击"上传 CSV 文件"按钮
   - **直接粘贴数据**: 在文本框中粘贴 CSV 数据
3. 点击"开始导入"按钮
4. 查看导入结果

### 方法 2: 使用测试数据
1. 下载 `test-data.csv` 文件
2. 在网页界面上传该文件
3. 点击导入

## 📊 CSV 格式要求

### 支持的列名（中英文均可）
```csv
ID,姓名,父亲电话,母亲电话,地址,父亲姓名,母亲姓名,生日,性别,中心
```

### 示例数据
```csv
ID,姓名,父亲电话,母亲电话,地址,父亲姓名,母亲姓名,生日,性别,中心
STU001,张三,0123456789,0987654321,吉隆坡市中心,张先生,李女士,2015-01-15,男,WX 01
STU002,李四,0123456790,0987654322,雪兰莪州,李先生,王女士,2014-03-20,女,WX 01
```

## 📅 年级自动计算规则

系统会根据出生日期自动计算年级，基于2024学年：

| 出生年份 | 年龄 | 年级 |
|---------|------|------|
| 2018 | 6岁 | 一年级 |
| 2017 | 7岁 | 二年级 |
| 2016 | 8岁 | 三年级 |
| 2015 | 9岁 | 四年级 |
| 2014 | 10岁 | 五年级 |
| 2013 | 11岁 | 六年级 |
| 2012 | 12岁 | 初一 |
| 2011 | 13岁 | 初二 |
| 2010 | 14岁 | 初三 |
| 2009 | 15岁 | 高一 |
| 2008 | 16岁 | 高二 |
| 2007 | 17岁 | 高三 |

## 🔄 年级格式支持

系统支持多种年级格式，会自动转换：

### 马来西亚格式 → 中文格式
- `Standard 1-6` → `一年级-六年级`
- `Form 1-3` → `初一-初三`
- `Form 4-6` → `高一-高三`

### 特殊情况处理
- **无效出生日期**：如果出生日期为 "0"、"#N/A" 或空，将使用CSV中的年级字段
- **格式转换**：自动将马来西亚年级格式转换为中文格式
- **手动调整**：可以在学生管理界面手动调整年级（越级、降级等）
- **空行过滤**：自动跳过没有姓名的空行数据

## 🔧 技术特点

- ✅ **无需 Google API 凭据** - 完全避免了 OpenSSL 兼容性问题
- ✅ **支持多种输入方式** - 文件上传 + 直接粘贴
- ✅ **自动字段映射** - 支持中英文列名
- ✅ **ID字段支持** - 支持 id, ID, student_id 作为学号
- ✅ **智能年级计算** - 根据出生日期自动计算年级
- ✅ **年级格式转换** - 自动转换马来西亚格式为中文格式
- ✅ **无效数据处理** - 智能处理 "0"、"#N/A" 等无效出生日期
- ✅ **空行过滤** - 自动跳过没有姓名的空行数据
- ✅ **手动年级调整** - 支持越级、降级等特殊情况
- ✅ **智能数据过滤** - 自动跳过空姓名、无效数据
- ✅ **错误处理** - 详细的导入结果反馈
- ✅ **数据验证** - 确保数据格式正确

## 📁 文件结构

```
✅ app/api/import/google-sheets/route.ts - 简化的 API 路由
✅ app/components/systems/data-import/simple-csv-import.tsx - 导入组件
✅ app/data-import/page.tsx - 导入页面
✅ test-data.csv - 测试数据文件
✅ scripts/test-csv-import.js - 测试脚本
```

## 🧪 测试结果

最新测试显示：
- ✅ 服务器连接正常
- ✅ PocketBase 认证成功
- ✅ 数据导入成功 (2/2 个学生)
- ✅ 统计数据获取正常 (当前 5 个学生)

## 🎯 下一步

1. 访问 http://localhost:3000/data-import
2. 尝试导入你的学生数据
3. 查看导入结果和统计数据

## 💡 提示

- 确保 CSV 文件使用 UTF-8 编码
- 第一行必须是列标题
- 必填字段：姓名
- 年级会根据出生日期自动计算
- 学号字段：支持 id, ID, student_id（可选，系统会自动生成）
- 其他字段为可选
- **自动过滤规则**：
  - 跳过空姓名或只包含空格的数据
  - 只导入有效的学生信息
- **年级调整**：
  - 导入后可在学生管理界面手动调整年级
  - 支持越级、降级等特殊情况

---

**问题已解决！现在可以正常使用 CSV 导入功能了。** 🎉
