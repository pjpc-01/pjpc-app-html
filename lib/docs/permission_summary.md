# 权限管理总结

## 角色权限分配

### 管理员 (Admin) 权限
管理员拥有系统的完全访问权限，可以管理所有功能模块：

#### 学生管理
- ✅ 创建学生
- ✅ 编辑学生信息
- ✅ 删除学生
- ✅ 查看所有学生数据
- ✅ 管理学生班级分配

#### 教师管理
- ✅ 创建教师
- ✅ 编辑教师信息
- ✅ 删除教师
- ✅ 查看所有教师数据
- ✅ 管理教师权限

#### 班级管理
- ✅ 创建班级
- ✅ 编辑班级信息
- ✅ 删除班级
- ✅ 管理班级学生分配

#### 考勤管理
- ✅ 查看所有考勤记录
- ✅ 管理考勤数据
- ✅ 生成考勤报表
- ✅ 处理考勤异常

#### 薪资管理
- ✅ 创建薪资记录
- ✅ 编辑薪资记录
- ✅ 删除薪资记录
- ✅ 查看所有薪资数据
- ✅ 管理薪资结构
- ✅ 生成薪资报表

#### 请假管理
- ✅ 创建请假记录
- ✅ 编辑请假记录
- ✅ 审批请假申请
- ✅ 拒绝请假申请
- ✅ 查看所有请假数据
- ✅ 管理请假余额

#### 绩效管理
- ✅ 创建绩效评估
- ✅ 编辑绩效评估
- ✅ 查看所有绩效数据
- ✅ 生成绩效报表

#### 培训管理
- ✅ 创建培训记录
- ✅ 编辑培训记录
- ✅ 查看所有培训数据
- ✅ 管理培训计划

#### 认证管理
- ✅ 创建认证记录
- ✅ 编辑认证记录
- ✅ 查看所有认证数据
- ✅ 管理认证状态

#### 系统管理
- ✅ 发送通知
- ✅ 查看所有通知
- ✅ 生成统计报表
- ✅ 系统设置
- ✅ 用户权限管理

### 教师 (Teacher) 权限
教师拥有有限的访问权限，主要关注教学相关功能：

#### 学生管理
- ✅ 创建学生
- ✅ 编辑学生信息
- ❌ 删除学生
- ✅ 查看分配的学生数据

#### 考勤管理
- ✅ 标记考勤
- ✅ 查看考勤记录
- ✅ 查看自己的考勤数据
- ✅ 生成个人考勤报表

#### 请假管理
- ✅ 创建请假记录
- ✅ 编辑自己的请假记录
- ❌ 审批他人请假申请
- ✅ 查看自己的请假数据
- ✅ 查看自己的请假余额

#### 薪资管理
- ❌ 创建薪资记录
- ❌ 编辑薪资记录
- ❌ 删除薪资记录
- ✅ 查看自己的薪资数据
- ❌ 管理薪资结构

#### 积分管理
- ✅ 管理学生积分
- ✅ 查看积分记录
- ✅ 添加/扣除积分

#### NFC管理
- ✅ NFC考勤打卡
- ✅ 管理NFC标签

#### 班级管理
- ✅ 查看分配的班级
- ✅ 管理班级学生
- ✅ 查看班级信息

#### 作业管理
- ✅ 创建作业
- ✅ 批改作业
- ✅ 查看作业成绩

#### 通知
- ✅ 查看通知
- ❌ 发送通知

### 家长 (Parent) 权限
家长只能查看与自己孩子相关的信息：

#### 学生数据
- ✅ 查看自己孩子的数据
- ❌ 查看其他学生数据

#### 考勤查看
- ✅ 查看孩子的考勤记录
- ❌ 管理考勤

#### 积分管理
- ✅ 查看积分记录
- ❌ 管理积分

#### 通知
- ✅ 查看通知

### 会计 (Accountant) 权限
会计主要负责财务相关功能：

#### 积分管理
- ✅ 查看积分记录
- ❌ 管理积分

#### 报表统计
- ✅ 查看财务报表
- ✅ 生成统计报告

## 权限控制实现

### 1. 功能访问控制
使用 `PermissionManager.canAccessFeature()` 检查用户是否可以访问特定功能：

```dart
if (!PermissionManager.canAccessFeature('teacher_salary_management', authProvider)) {
  // 显示无权限提示
  return NoPermissionWidget();
}
```

### 2. 操作权限控制
使用 `PermissionManager.canPerformAction()` 检查用户是否可以执行特定操作：

```dart
if (PermissionManager.canPerformAction('create_salary_record', authProvider)) {
  // 显示创建按钮
  return CreateButton();
}
```

### 3. 数据过滤
在Provider层根据用户角色过滤数据：

```dart
// 教师只能查看自己的数据
if (authProvider.isTeacher) {
  records = records.where((r) => r.teacherId == currentUserId).toList();
}
```

## 安全考虑

1. **前端权限控制**：UI层面的权限控制，提供良好的用户体验
2. **后端权限验证**：在PocketBase服务层进行权限验证，确保数据安全
3. **数据隔离**：不同角色只能访问授权范围内的数据
4. **操作审计**：记录敏感操作的日志，便于追踪

## 权限扩展

如需添加新的权限控制：

1. 在 `PermissionManager` 中添加新的功能或操作
2. 在相应的UI组件中添加权限检查
3. 在Provider层添加数据过滤逻辑
4. 在PocketBase服务层添加权限验证

## 注意事项

- 权限检查应该在多个层面进行，确保安全性
- 用户角色变更后需要重新加载权限
- 敏感操作需要额外的确认步骤
- 定期审查和更新权限配置

