# ğŸ“Š å¤šèº«ä»½ç”¨æˆ·æ•°æ®åº“é…ç½®

## ğŸ—„ï¸ ä½¿ç”¨çš„é›†åˆ

### **ä¸»è¦é›†åˆï¼š`users`**
- è¿™æ˜¯ç”¨æˆ·è®¤è¯å’ŒåŸºæœ¬ä¿¡æ¯çš„ä¸»è¦é›†åˆ
- å­˜å‚¨ç”¨æˆ·ç™»å½•å‡­æ®å’Œè§’è‰²ä¿¡æ¯

## ğŸ“‹ éœ€è¦æ·»åŠ çš„å­—æ®µ

### **å¤šè§’è‰²æ”¯æŒå­—æ®µ**

#### **1. `roles` (Text)**
- **ç±»å‹**ï¼šText
- **æè¿°**ï¼šå­˜å‚¨ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰è§’è‰²ï¼Œç”¨é€—å·åˆ†éš”
- **ç¤ºä¾‹å€¼**ï¼š
  - `"admin"` - å•ä¸€ç®¡ç†å‘˜è§’è‰²
  - `"teacher,parent"` - æ•™å¸ˆ+å®¶é•¿åŒé‡è§’è‰²
  - `"admin,teacher,parent"` - ä¸‰é‡è§’è‰²
- **é»˜è®¤å€¼**ï¼šç©ºå­—ç¬¦ä¸²
- **å¿…å¡«**ï¼šå¦

#### **2. `active_role` (Text)**
- **ç±»å‹**ï¼šText
- **æè¿°**ï¼šå½“å‰æ¿€æ´»çš„è§’è‰²
- **ç¤ºä¾‹å€¼**ï¼š
  - `"admin"` - å½“å‰ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½
  - `"teacher"` - å½“å‰ä½¿ç”¨æ•™å¸ˆèº«ä»½
  - `"parent"` - å½“å‰ä½¿ç”¨å®¶é•¿èº«ä»½
- **é»˜è®¤å€¼**ï¼šç©ºå­—ç¬¦ä¸²
- **å¿…å¡«**ï¼šå¦

#### **3. `role_switching_enabled` (Bool)**
- **ç±»å‹**ï¼šBool
- **æè¿°**ï¼šæ˜¯å¦å…è®¸å¤šè§’è‰²åˆ‡æ¢
- **ç¤ºä¾‹å€¼**ï¼š
  - `true` - å…è®¸å¤šè§’è‰²åˆ‡æ¢
  - `false` - ä¸å…è®¸è§’è‰²åˆ‡æ¢
- **é»˜è®¤å€¼**ï¼š`false`
- **å¿…å¡«**ï¼šå¦

## ğŸ”§ æ•°æ®åº“æ“ä½œ

### **æ·»åŠ å­—æ®µçš„SQLå‘½ä»¤**

```sql
-- æ·»åŠ å¤šè§’è‰²æ”¯æŒå­—æ®µ
ALTER TABLE users ADD COLUMN roles TEXT DEFAULT '';
ALTER TABLE users ADD COLUMN active_role TEXT DEFAULT '';
ALTER TABLE users ADD COLUMN role_switching_enabled BOOLEAN DEFAULT false;
```

### **PocketBaseç®¡ç†ç•Œé¢æ“ä½œ**

1. **è¿›å…¥PocketBaseç®¡ç†ç•Œé¢**
2. **é€‰æ‹© `users` é›†åˆ**
3. **ç‚¹å‡» "Schema" æ ‡ç­¾**
4. **æ·»åŠ ä»¥ä¸‹å­—æ®µ**ï¼š

#### **å­—æ®µ1ï¼šroles**
- **Name**: `roles`
- **Type**: `Text`
- **Default**: `""`
- **Required**: `false`

#### **å­—æ®µ2ï¼šactive_role**
- **Name**: `active_role`
- **Type**: `Text`
- **Default**: `""`
- **Required**: `false`

#### **å­—æ®µ3ï¼šrole_switching_enabled**
- **Name**: `role_switching_enabled`
- **Type**: `Bool`
- **Default**: `false`
- **Required**: `false`

## ğŸ“ æµ‹è¯•æ•°æ®ç¤ºä¾‹

### **å•ä¸€è§’è‰²ç”¨æˆ·ï¼ˆä¿æŒå…¼å®¹ï¼‰**
```json
{
  "id": "user1",
  "email": "admin@example.com",
  "role": "admin",
  "roles": "",
  "active_role": "",
  "role_switching_enabled": false
}
```

### **å¤šè§’è‰²ç”¨æˆ·ç¤ºä¾‹**

#### **æ•™å¸ˆ+å®¶é•¿**
```json
{
  "id": "user2",
  "email": "teacher_parent@example.com",
  "role": "teacher",
  "roles": "teacher,parent",
  "active_role": "teacher",
  "role_switching_enabled": true
}
```

#### **ç®¡ç†å‘˜+æ•™å¸ˆ**
```json
{
  "id": "user3",
  "email": "admin_teacher@example.com",
  "role": "admin",
  "roles": "admin,teacher",
  "active_role": "admin",
  "role_switching_enabled": true
}
```

#### **ä¸‰é‡èº«ä»½**
```json
{
  "id": "user4",
  "email": "triple_role@example.com",
  "role": "admin",
  "roles": "admin,teacher,parent",
  "active_role": "admin",
  "role_switching_enabled": true
}
```

## ğŸ”„ æ•°æ®è¿ç§»

### **ç°æœ‰ç”¨æˆ·æ•°æ®è¿ç§»**

å¯¹äºç°æœ‰çš„å•ä¸€è§’è‰²ç”¨æˆ·ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å…¼å®¹ï¼š

1. **å¦‚æœ `roles` å­—æ®µä¸ºç©º**ï¼š
   - ç³»ç»Ÿä¼šè¯»å– `role` å­—æ®µ
   - å°† `role` å€¼è®¾ç½®ä¸º `roles` å’Œ `active_role`
   - ä¿æŒåŸæœ‰åŠŸèƒ½ä¸å˜

2. **å¦‚æœ `roles` å­—æ®µæœ‰å€¼**ï¼š
   - ç³»ç»Ÿä¼šè§£æ `roles` å­—æ®µ
   - ä½¿ç”¨ `active_role` ä½œä¸ºå½“å‰è§’è‰²
   - å¯ç”¨å¤šè§’è‰²åŠŸèƒ½

### **è¿ç§»è„šæœ¬ç¤ºä¾‹**

```sql
-- ä¸ºç°æœ‰ç”¨æˆ·è®¾ç½®é»˜è®¤å€¼
UPDATE users SET 
  roles = CASE 
    WHEN roles = '' THEN role 
    ELSE roles 
  END,
  active_role = CASE 
    WHEN active_role = '' THEN role 
    ELSE active_role 
  END,
  role_switching_enabled = CASE 
    WHEN roles LIKE '%,%' THEN true 
    ELSE false 
  END
WHERE roles IS NOT NULL;
```

## ğŸ¯ ä½¿ç”¨è¯´æ˜

### **åˆ›å»ºå¤šè§’è‰²ç”¨æˆ·**

1. **åœ¨PocketBaseç®¡ç†ç•Œé¢åˆ›å»ºæ–°ç”¨æˆ·**
2. **è®¾ç½® `roles` å­—æ®µ**ï¼š`"admin,teacher"`
3. **è®¾ç½® `active_role` å­—æ®µ**ï¼š`"admin"`
4. **è®¾ç½® `role_switching_enabled` å­—æ®µ**ï¼š`true`

### **æµ‹è¯•è§’è‰²åˆ‡æ¢**

1. **ä½¿ç”¨å¤šè§’è‰²ç”¨æˆ·ç™»å½•**
2. **æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºè§’è‰²åˆ‡æ¢å™¨**
3. **ç‚¹å‡»å…¶ä»–è§’è‰²è¿›è¡Œåˆ‡æ¢**
4. **éªŒè¯ç•Œé¢åŠŸèƒ½å˜åŒ–**

## âš ï¸ æ³¨æ„äº‹é¡¹

### **å­—æ®µå‘½å**
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- å­—æ®µåå¿…é¡»ä¸ä»£ç ä¸­çš„ä¸€è‡´
- ä¸è¦ä¿®æ”¹ç°æœ‰å­—æ®µå

### **æ•°æ®ç±»å‹**
- `roles` å¿…é¡»æ˜¯ Text ç±»å‹
- `active_role` å¿…é¡»æ˜¯ Text ç±»å‹
- `role_switching_enabled` å¿…é¡»æ˜¯ Bool ç±»å‹

### **é»˜è®¤å€¼**
- æ–°å­—æ®µå¿…é¡»æœ‰é»˜è®¤å€¼
- é»˜è®¤å€¼è¦ä¸ä»£ç é€»è¾‘ä¸€è‡´
- é¿å…ç©ºå€¼å¯¼è‡´çš„é”™è¯¯

### **å…¼å®¹æ€§**
- ä¿æŒä¸ç°æœ‰ `role` å­—æ®µçš„å…¼å®¹æ€§
- å•ä¸€è§’è‰²ç”¨æˆ·ä¸å—å½±å“
- å¤šè§’è‰²ç”¨æˆ·è·å¾—æ–°åŠŸèƒ½

## ğŸš€ å®æ–½æ­¥éª¤

1. **å¤‡ä»½ç°æœ‰æ•°æ®**
2. **æ·»åŠ æ–°å­—æ®µåˆ° `users` é›†åˆ**
3. **è®¾ç½®å­—æ®µé»˜è®¤å€¼**
4. **æµ‹è¯•ç°æœ‰ç”¨æˆ·ç™»å½•**
5. **åˆ›å»ºæµ‹è¯•ç”¨çš„å¤šè§’è‰²ç”¨æˆ·**
6. **éªŒè¯è§’è‰²åˆ‡æ¢åŠŸèƒ½**

ç°åœ¨ä½ åªéœ€è¦åœ¨ `users` é›†åˆä¸­æ·»åŠ è¿™3ä¸ªå­—æ®µå°±å¯ä»¥å¯ç”¨å¤šèº«ä»½ç”¨æˆ·åŠŸèƒ½äº†ï¼
