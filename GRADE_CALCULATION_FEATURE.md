# 年级自动计算功能

## 🎯 功能概述

根据学生的出生日期自动计算年级，支持手动调整特殊情况。

## 📅 年级计算规则

基于2024学年，根据出生年份自动计算年级：

| 出生年份 | 年龄 | 年级 | 级别 |
|---------|------|------|------|
| 2018 | 6岁 | 一年级 | 小学 |
| 2017 | 7岁 | 二年级 | 小学 |
| 2016 | 8岁 | 三年级 | 小学 |
| 2015 | 9岁 | 四年级 | 小学 |
| 2014 | 10岁 | 五年级 | 小学 |
| 2013 | 11岁 | 六年级 | 小学 |
| 2012 | 12岁 | 初一 | 初中 |
| 2011 | 13岁 | 初二 | 初中 |
| 2010 | 14岁 | 初三 | 初中 |
| 2009 | 15岁 | 高一 | 高中 |
| 2008 | 16岁 | 高二 | 高中 |
| 2007 | 17岁 | 高三 | 高中 |

## 🔧 技术实现

### 1. 出生日期解析
支持多种日期格式：
- `12 July 2013`
- `2013-07-12`
- `12/07/2013`
- `2013/07/12`
- `2013` (仅年份)

### 2. 年级计算逻辑
```typescript
function getGradeFromBirthYear(birthYear: number): string {
  const baseYear = 2024 // 基准学年
  const age = baseYear - birthYear
  
  // 根据年龄返回对应年级
  if (age === 6) return '一年级'
  if (age === 7) return '二年级'
  // ... 其他年级
}
```

### 3. 数据存储
每个学生记录包含：
- `standard`: 当前年级（自动计算或手动设置）
- `manual_grade_override`: 手动调整的年级（如果有）
- `grade_override_reason`: 调整原因

## 🎛️ 手动调整功能

### 使用场景
- 越级学生
- 降级学生
- 特殊情况（如复读、跳级等）

### 操作方式
1. 在学生管理界面找到目标学生
2. 点击"年级管理"卡片
3. 点击"调整年级"按钮
4. 选择新的年级
5. 填写调整原因（可选）
6. 保存更改

### 功能特点
- ✅ 可以随时调整年级
- ✅ 记录调整原因
- ✅ 可以恢复自动计算
- ✅ 显示当前年级和计算年级的对比

## 📊 导入流程

1. **CSV 导入**：
   - 解析出生日期
   - 自动计算年级
   - 保存到数据库

2. **手动调整**（可选）：
   - 在学生管理界面调整年级
   - 记录调整原因
   - 更新数据库

## 🧪 测试结果

### 测试数据
```csv
姓名,生日,期望年级,实际年级
Jayden Ng Junn Kyle 黄俊凯,12 July 2013,六年级,六年级 ✅
测试学生1,2018,一年级,一年级 ✅
测试学生2,2017,二年级,二年级 ✅
测试学生3,2016,三年级,三年级 ✅
测试学生4,2015,四年级,四年级 ✅
测试学生5,2014,五年级,五年级 ✅
测试学生6,2012,初一,初一 ✅
测试学生7,2011,初二,初二 ✅
```

### 测试覆盖率
- ✅ 所有年级计算正确
- ✅ 日期格式解析正常
- ✅ 手动调整功能正常
- ✅ 数据存储正确

## 🚀 使用方法

### 1. CSV 导入
```csv
姓名,生日,父亲电话,母亲电话,地址,性别,中心
张三,2015-01-15,0123456789,0987654321,吉隆坡市中心,男,WX 01
李四,2014-03-20,0123456790,0987654322,雪兰莪州,女,WX 01
```

### 2. 手动调整
- 访问学生管理界面
- 找到需要调整的学生
- 使用年级管理功能进行调整

## 📝 注意事项

1. **基准学年**：当前使用2024年作为基准学年
2. **日期格式**：支持多种常见日期格式
3. **特殊情况**：可以通过手动调整处理
4. **数据备份**：调整前建议备份数据
5. **权限控制**：年级调整需要相应权限

## 🔄 未来改进

- [ ] 支持学年配置（可调整基准学年）
- [ ] 批量年级调整功能
- [ ] 年级调整历史记录
- [ ] 自动学年更新
- [ ] 年级统计报表

---

**功能已完全实现并测试通过！** 🎉
