# 智能网络配置使用说明

## 概述

本应用已配置智能网络检测功能，可以自动在局域网和DDNS之间切换，确保无论你在中心还是在家都能正常使用。

## 功能特性

### 🔄 自动网络检测
- 自动检测当前网络环境
- 优先尝试局域网连接（192.168.0.59:8090）
- 失败时自动切换到DDNS连接（pjpc.tplinkdns.com:8090）

### 📊 实时状态监控
- 显示当前连接状态
- 显示网络类型（局域网/DDNS）
- 显示服务器地址和响应延迟
- 自动每5分钟检查一次连接状态

### 🎛️ 手动控制
- 手动刷新连接状态
- 手动切换网络连接
- 实时错误信息显示

## 使用方法

### 1. 自动模式（推荐）
应用会自动检测网络环境并选择最佳连接方式：
- 在中心时：自动使用局域网连接
- 在家时：自动使用DDNS连接

### 2. 手动配置（可选）
如果需要固定使用某种连接方式，可以创建 `.env.local` 文件：

```bash
# 固定使用局域网（在中心时）
LOCAL_POCKETBASE_URL=http://192.168.0.59:8090

# 或固定使用DDNS（在家时）
NEXT_PUBLIC_POCKETBASE_URL=http://pjpc.tplinkdns.com:8090
```

### 3. 查看连接状态
在应用界面中可以看到网络连接状态组件，显示：
- ✅ 连接状态（已连接/连接失败）
- 🌐 网络类型（局域网/DDNS）
- 📍 服务器地址
- ⏱️ 响应延迟
- 🔄 最后检查时间

## 故障排除

### 连接失败
1. 检查网络连接是否正常
2. 确认PocketBase服务器是否运行
3. 尝试手动刷新连接状态
4. 检查防火墙设置

### 切换网络
1. 点击"切换网络"按钮
2. 等待自动检测完成
3. 查看新的连接状态

### 性能优化
- 局域网连接延迟通常 < 10ms
- DDNS连接延迟通常 < 100ms
- 如果延迟过高，可以尝试重新连接

## 技术细节

### 检测逻辑
1. 首先尝试局域网连接（3秒超时）
2. 如果失败，尝试DDNS连接（3秒超时）
3. 选择响应最快的连接方式
4. 缓存结果1分钟，避免频繁检测

### 错误处理
- 连接超时：自动重试
- 网络错误：显示详细错误信息
- 服务器错误：尝试其他连接方式

## 环境变量

| 变量名 | 说明 | 示例 |
|--------|------|------|
| `LOCAL_POCKETBASE_URL` | 局域网PocketBase地址 | `http://192.168.0.59:8090` |
| `NEXT_PUBLIC_POCKETBASE_URL` | DDNS PocketBase地址 | `http://pjpc.tplinkdns.com:8090` |
| `PORT` | 开发服务器端口 | `3004` |

## 注意事项

1. **首次启动**：应用需要几秒钟来检测网络环境
2. **网络切换**：从中心到家或反之，应用会自动适应
3. **缓存机制**：连接信息会缓存1分钟，避免频繁检测
4. **错误恢复**：连接失败时会自动尝试其他方式

## 支持

如果遇到问题，请检查：
1. 控制台错误信息
2. 网络连接状态
3. PocketBase服务器状态
4. 防火墙和端口设置
